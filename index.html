<html>

<head>
    <title>antibodysplash</title>
    <style>
        body {
            margin: 0;
        }

        canvas {
            width: 100vw;
            height: 100vh;
            display: block;
            background: rgb(255, 156, 145);
            background-size: cover;
            display: block;
        }
    </style>
</head>

<body>
    <script type="module">
        import * as THREE from './build/three.module.js';
        import { OrbitControls } from './examples/jsm/controls/OrbitControls.js';
        import { FBXLoader } from './examples/jsm/loaders/FBXLoader.js';
        import { RectAreaLightHelper } from './examples/jsm/helpers/RectAreaLightHelper.js';
        import { Reflector } from './examples/jsm/objects/Reflector.js';
        var WIDTH = window.innerWidth;
        var HEIGHT = window.innerHeight;
        var renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(WIDTH, HEIGHT);
        var scene = new THREE.Scene();
        var texture = new THREE.TextureLoader().load(
            "https://images.pexels.com/photos/110854/pexels-photo-110854.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=650&w=940"
        );
        // scene.background = texture;

        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);
        var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 1000);
        camera.position.set(10, 10, 5);
        camera.lookAt(new THREE.Vector3(0, 0, 0));
        var controls = new OrbitControls(camera, renderer.domElement);
        var geometry = new THREE.BoxGeometry();
        var material = new THREE.MeshPhongMaterial({ color: 0xd6d6d6 });
        var cube = new THREE.Mesh(geometry, material);
        var gridXZ = new THREE.GridHelper(10, 10, 0xff0000, 0xffffff);

        //scene.add(gridXZ);
        var loader = new FBXLoader();
        loader.load('models/fbx/myModel3.fbx', function (object) {
            object.scale.set(0.01, 0.01, 0.01);
            //var ac = new THREE.Mesh(object,material);
            object.traverse(function (object) {

                if (object.isMesh) {


                    const oldMat = object.material;
                    object.material = new THREE.MeshPhongMaterial({ color: 0xffffff, side: THREE.DoubleSide, });

                    /* object.material = new THREE.MeshPhysicalMaterial({
                         color: 0xffffff,
                         map: oldMat.map,
                         side: THREE.DoubleSide,
                         reflectivity: 1.0,
                         metalness: 0.0
                         //etc
                     });*/

                }
            });
            //scene.add(object.children[3]);
            scene.add(object);
            scene.add(object.children[0].children[4]);
            object.children[0].children[0].material = new THREE.MeshPhongMaterial({ color: 0xff0000, emissive: 0xffffff, emissiveIntensity: 0.05, specular: 0xffffff });
            object.children[0].children[3].material = new THREE.MeshStandardMaterial({ color: 0xffffff, transparent: true, opacity: 0.9 /*emissive:  0xffffff,  emissiveIntensity : 100*/ });
            console.log(object.children[0]);



        });
        //console.log(object);
        var directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
        directionalLight.position.set(0, 10, 10);
        directionalLight.target.position.set(2, 0, 0);
        //scene.add(directionalLight);
        //scene.add(directionalLight.target);
        cube.position.set(2, 0, 0);
        //scene.add(cube);
        var width = 8;
        var height = 2;
        var intensity = 1;
        var rectLight = new THREE.RectAreaLight(0x486e62, intensity, width, height);
        rectLight.position.set(0, 5.2, 1);
        rectLight.lookAt(0, 0, 1);
        scene.add(rectLight)


        //var spotLight = new THREE.SpotLight( 0xff5040,10,0,3.0,1,0);
        //var tunnelLight1 = new THREE.PointLight(0xff5040, 2, 100, 0); //keeps going
        //var tunnelLight1 = new THREE.PointLight(0xff5040, 2.2, 120, 16);
        //tunnelLight1.position.set(0, 1, -12);
        //scene.add(tunnelLight1);

        var tunnelLight2 = new THREE.PointLight(0x009686, 1.5, 40, 14);
        tunnelLight2.position.set(-1, 2.5, -1.5);
        scene.add(tunnelLight2);

        var tl = [];
        let amt = 20;

        for (let i = 0; i < amt; i++) {
            tl[i] = new THREE.PointLight(0xff5040, 2, 120, 16);
            tl[i].position.set(0, 1, -12 - (10.5 * i));
            scene.add(tl[i]);
        }
        /*
        var tunnelLight3 = new THREE.PointLight(0xff5040, 2.2, 120, 16);
        tunnelLight3.position.set(0, 1, -22.5);
        scene.add(tunnelLight3);

        var tunnelLight4 = new THREE.PointLight(0xff5040, 2.2, 120, 16);
        tunnelLight4.position.set(0, 1, -33);
        scene.add(tunnelLight4);
        */

        var leftLight = new THREE.RectAreaLight(0xff5040, 2, 0.08, 2);
        leftLight.position.set(2.04, 1.5, 0.7);
        leftLight.lookAt(2.04, 1.5, -10);
        scene.add(leftLight);
        var rightLight = new THREE.RectAreaLight(0xff5040, 2, 0.08, 2);
        rightLight.position.set(-2.04, 1.5, 0.7);
        rightLight.lookAt(-2.04, 1.5, -10);
        scene.add(rightLight);
        var pb = new THREE.PlaneBufferGeometry(100, 100);
        var groundMirror = new Reflector(pb, {
            clipBias: 0.003,
            textureWidth: WIDTH * window.devicePixelRatio,
            textureHeight: HEIGHT * window.devicePixelRatio,
            color: 0x009686
        });
        groundMirror.position.y = -0.7;
        groundMirror.rotateX(- Math.PI / 2);
        scene.add(groundMirror);


        var pb2 = new THREE.PlaneBufferGeometry(1, 1);
        var backMirror = new Reflector(pb, {
            clipBias: 0.003,
            textureWidth: WIDTH * window.devicePixelRatio,
            textureHeight: HEIGHT * window.devicePixelRatio,
            color: 0x009686
        });
        backMirror.position.z -= 12.0;
        //scene.add(backMirror);

        var pb3 = new THREE.PlaneBufferGeometry(10, 10);
        var backMirror2 = new Reflector(pb3, {
            clipBias: 0.003,
            textureWidth: WIDTH * window.devicePixelRatio,
            textureHeight: HEIGHT * window.devicePixelRatio,
            color: 0x009686
        });
        backMirror2.position.z -= 0.8;
        backMirror2.rotateX(- Math.PI);
        //scene.add(backMirror2);
        var signLight = new THREE.SpotLight(0xFFF1E0, 1,1 );
        signLight.position.set(0, 4.3, 0.7);
        //signLight.lookAt(0, 3.3, -10);
        //scene.add(signLight);
        // var helper = new RectAreaLightHelper(signLight);
        // signLight.add(helper);
        //renderer.setFaceCulling(THREE.CullFaceNone);
        controls.update();
        //camera.position.z = 5;
        var animate = function () {
            requestAnimationFrame(animate);
            var timer = Date.now() * 0.005;

            //tunnelLight1.intensity = 2 + (Math.sin(timer * 0.1) * 2);
            for (let i = 0; i < amt; i++) {
                // console.log(i%3);
                switch (i % 3) {
                    case 0:
                        tl[i].intensity = 2 + (Math.cos(timer * 0.1+i) * 1.9);
                        break;
                    case 1:
                        tl[i].intensity = 1.5 + (Math.cos(timer * 0.166+i) * 1.3);
                        break;
                    default:
                        tl[i].intensity = 1.5 + (Math.sin(timer * 0.1165+i) * 1.4);

                }

               // tl[i].intensity = i % 2 == 0 ? (1 + (Math.cos(timer * 0.1 * i + i) * 2)) : (1 + (Math.sin(timer * 0.1 * i + i) * 2));
            }
            tunnelLight2.intensity = 2 + (Math.cos(timer * 0.133) * 1);
            //tunnelLight3.intensity = 1 + (Math.cos(timer * 0.166) * 1.5);
            // tunnelLight4.intensity = 1 + (Math.sin(timer * 0.1165) * 1.5);

            controls.update();
            renderer.render(scene, camera);
        };
        animate();
    </script>
</body>

</html>